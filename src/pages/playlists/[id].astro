---
import { playlistBy, artists, songsBy, amountOfSongs, duration } from "@/domain/playlists";
import Layout from "@/layouts/Layout.astro";
import ClockIcon from "@/icons/ClockIcon.astro";
import { CardPlayButton } from "@/components/CardPlayButton";

const { id } = Astro.params;

const playlist = playlistBy(id!);
---

{
  playlist && (
    <Layout>
      <div
        id="playlist-container"
        class="relative flex flex-col overflow-x-hidden gap-8"
        style={`background-color: ${playlist.color.accent}`}
        transition:name={`playlist-${id}-card`}
      >
        <header class="flex gap-4 p-5 font-light mt-10">
          <picture class="flex-none w-52 h-52">
            <img
              src={playlist.cover}
              alt={`Cover of ${playlist.title}`}
              class="object-cover w-full h-full shadow-lg"
              transition:name={`playlist-${playlist.id}-image`}
            />
          </picture>
          <div class="flex flex-col justify-between">
            <h2 class="flex flex-1 items-end">PLAYLIST</h2>
            <h1 class="text-6xl font-bold text-white">
              <span transition:name={`playlist-${playlist.id}-title`}>
                {playlist?.title}
              </span>
            </h1>
            <div class="flex flex-1 items-end text-gray-400">
              <span transition:name={`playlist-${playlist.id}-artists`}>{artists(playlist)}</span>
            </div>
            <div class="flex flex-1 items-end">
              <p class="text-white">{amountOfSongs(playlist)} songs, {duration(playlist)}</p>
            </div>
          </div>
        </header>
        <section class="p-5">
        <div class="p-2 mb-1">
              <CardPlayButton client:load id={playlist.id} />
        </div>
        <table class="table auto text-left min-w-full divide-y-2 divide-zinc-500/20 text-sm">
          <thead>
            <tr class="text-gray-400">
              <th class="px-4 py-2">#</th>
              <th class="px-4 py-2">TITLE</th>
              <th class="px-4 py-2">ALBUM</th>
              <th class="px-4 py-2"><ClockIcon/></th>
            </tr>
          </thead>
          <tbody>
            {songsBy(playlist).map((song, index) => (
              <tr class="text-gray-400 hover:bg-zinc-300/10 transition duration-300">
              <td class="px-4 py-2 w-5">{index + 1}</td>
              <td class="px-4 py-2">
                <div class="flex flex-row gap-5">
                <img src={song.coverUrl} alt={`Cover of ${song.title}`} class="w-12 h-12 object-cover" />
                <div class="flex flex-col justify-between">
                  <span class="text-white">{song.title}</span>
                  <span class="text-gray-400">{song.artist}</span>
                </div>
                </div>
              </td>
              <td class="px-4 py-2">{song.album}</td>
              <td class="px-4 py-2">{song.duration}</td>
              </tr>
            ))
          }
          </tbody>
        </table>
        </section>
        <div class="relative z-10 px-6 py-10" />
        <div class="absolute inset-0 bg-gradient-to-t from-zinc-900 via-zinc-900/80 -z-10"></div>
        
      </div>
    </Layout>
  )
}
